# ๐ ุฏููู ุงูุชุดุบูู ุงูุณุฑูุน ููู Backend

## โ ุฎุทูุงุช ุงูุชุดุบูู

### 1๏ธโฃ ุชุซุจูุช Dependencies
```bash
cd backend
npm install
```

### 2๏ธโฃ ุฅุนุฏุงุฏ Service Account Key
1. ุงุฐูุจ ุฅูู Firebase Console
2. ุงุฎุชุฑ ูุดุฑูุนู (mybus-5a992)
3. ุงุฐูุจ ุฅูู Settings > Service Accounts
4. ุงุถุบุท ุนูู "Generate new private key"
5. ุงุญูุธ ุงูููู ูู `serviceAccountKey.json` ูู ูุฌูุฏ `backend`

### 3๏ธโฃ ุชุดุบูู ุงูุฎุฏูุฉ
```bash
npm start
```

ุฃู ููุชุทููุฑ ูุน ุฅุนุงุฏุฉ ุงูุชุดุบูู ุงูุชููุงุฆู:
```bash
npm run dev
```

## ๐ ูุงุฐุง ููุนู ุงูู Backendุ

### ๐ฅ ุงููุฑุงูุจุฉ ุงูุฑุฆูุณูุฉ (ุงูุฃูู):
- **fcm_queue**: ูุฑุงูุจ ูุงุฆูุฉ ุงูุฅุดุนุงุฑุงุช ุงูููุชุธุฑุฉ ููุฑุณููุง ุนุจุฑ FCM
  - ุนูุฏูุง Flutter ูุถูู ุฅุดุนุงุฑ ูู `fcm_queue`
  - Backend ูุฃุฎุฐู ููุฑุณูู ุนุจุฑ FCM ุงูุญูููู
  - ุงูุฅุดุนุงุฑ ูุธูุฑ **ุฎุงุฑุฌ ุงูุชุทุจูู** ุญุชู ูู ูุงู ูุบูู

### ๐ฑ ูุฑุงูุจุงุช ุฅุถุงููุฉ:
- **trips**: ุฑุญูุงุช ุงูุทูุงุจ (ุฑููุจ/ูุฒูู)
- **absences**: ุทูุจุงุช ุงูุบูุงุจ (ุฌุฏูุฏุฉ/ููุงููุฉ/ุฑูุถ)
- **complaints**: ุงูุดูุงูู ุงูุฌุฏูุฏุฉ

## ๐ ููู ุชุชุฃูุฏ ุฃูู ูุนููุ

### 1. ุณุชุฑู ูู Console:
```
๐ MyBus Notification Service Started!
๐ก Listening to Firestore changes...
โ ุฌููุน ุงููุฑุงูุจุงุช ูุดุทุฉ:
   - fcm_queue (ุงูุฃูู ูุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช)
   - trips (ุฑุญูุงุช ุงูุทูุงุจ)
   - absences (ุทูุจุงุช ุงูุบูุงุจ)
   - complaints (ุงูุดูุงูู)
๐ Service is running...
```

### 2. ุนูุฏ ุฅุฑุณุงู ุฅุดุนุงุฑุ ุณุชุฑู:
```
๐ค ูุนุงูุฌุฉ ุฅุดุนุงุฑ ุฌุฏูุฏ ูู ุงููุงุฆูุฉ: abc123
   ุงููุณุชูู: user_xyz
   ุงูุนููุงู: ุฅุดุนุงุฑ ุฌุฏูุฏ
   โ ุฅุดุนุงุฑ ูุฑุณู ุจูุฌุงุญ: projects/.../messages/0:1234...
   โ ุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุฅุดุนุงุฑ ูู ุงููุงุฆูุฉ
```

## ๐ ุญู ุงููุดุงูู

### ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช ูู Consoleุ
- ุชุฃูุฏ ุฃู ุงูุชุทุจูู ูุถูู ุฅูู `fcm_queue` collection
- ุชุญูู ูู ุฃู `serviceAccountKey.json` ููุฌูุฏ ูุตุญูุญ

### ุฎุทุฃ ูู ุงูุงุชุตุงูุ
- ุชุฃูุฏ ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
- ุชุญูู ูู ุตุญุฉ Firebase Database URL ูู `.env`

### ุงูุฅุดุนุงุฑุงุช ูุง ุชุธูุฑ ุฎุงุฑุฌ ุงูุชุทุจููุ
- ุชุฃูุฏ ุฃู FCM Token ูุญููุธ ูู Firestore ูููุณุชุฎุฏู
- ุชุญูู ูู ุฃุฐููุงุช ุงูุฅุดุนุงุฑุงุช ูู ุงูุฌูุงุฒ
- ููููุจ: ุชุญูู ูู ุฃู `firebase-messaging-sw.js` ููุฌูุฏ

## ๐ ูููุดุฑ ุนูู ุงูุฅูุชุฑูุช

### ุงุณุชุฎุฏุงู Railway (ูุฌุงูู):
1. ุงุฐูุจ ุฅูู https://railway.app
2. ุฃูุดุฆ ุญุณุงุจ ุฌุฏูุฏ
3. New Project > Deploy from GitHub
4. ุงุฎุชุฑ repository ุงูุฎุงุต ุจู
5. ุงุฎุชุฑ ูุฌูุฏ `backend`
6. ุฃุถู Environment Variables:
   - `SERVICE_ACCOUNT_KEY`: ูุญุชูู ููู serviceAccountKey.json ูู JSON string
   - `FIREBASE_DATABASE_URL`: https://mybus-5a992.firebaseio.com
7. Deploy!

ุณูุนุทูู Railway ุฑุงุจุท ูุซู: `https://your-app.up.railway.app`

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูู Backend ูุฌุจ ุฃู ูููู ุดุบุงู ุฏุงุฆูุงู** ูุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช ุฎุงุฑุฌ ุงูุชุทุจูู
2. ุฅุฐุง ุฃุบููุช Terminalุ ุงูู Backend ุณูุชููู ูุงูุฅุดุนุงุฑุงุช ูู ุชูุฑุณู
3. ููุงุณุชุฎุฏุงู ุงูุญููููุ ูุฌุจ ูุดุฑู ุนูู ุฎุงุฏู (Railway, Heroku, VPS)
4. ุงูุฅุดุนุงุฑุงุช ุชูุญูุธ ูู `fcm_queue` ูุชูุญุฐู ุจุนุฏ 24 ุณุงุนุฉ ุชููุงุฆูุงู

## ๐ฏ ุงููุฑู ุจูู ูุจู ูุจุนุฏ:

### โ ูุจู (ุจุฏูู Backend):
- ุงูุฅุดุนุงุฑุงุช ุชุธูุฑ **ุฏุงุฎู ุงูุชุทุจูู ููุท**
- ูู ุงูุชุทุจูู ูุบููุ ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช

### โ ุจุนุฏ (ูุน Backend):
- ุงูุฅุดุนุงุฑุงุช ุชุธูุฑ **ุฎุงุฑุฌ ุงูุชุทุจูู**
- ุชุนูู ุญุชู ูู ุงูุชุทุจูู ูุบูู ุชูุงูุงู
- ุชุธูุฑ ูู ุดุฑูุท ุงูุฅุดุนุงุฑุงุช ูุซู WhatsApp
