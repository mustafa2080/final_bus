# ๐ ุฏููู ุงููุธุงู ุงููุญุณู ููุฅุดุนุงุฑุงุช ูุงููุตุงุฏูุฉ - ููุฏุฒ ุจุงุต

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ูุญุณู ููุฅุดุนุงุฑุงุช ูุงููุตุงุฏูุฉ ูุถูู:
- **ุฅุดุนุงุฑุงุช ูุฎุตุตุฉ ููู ูุณุชุฎุฏู** - ุชุธูุฑ ููุท ูููุณุชุฎุฏู ุงููุณุชูุฏู
- **ุงูุญูุงุธ ุนูู ุชุณุฌูู ุงูุฏุฎูู** - ูุง ูุฎุฑุฌ ุงููุณุชุฎุฏู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู
- **ุฅุดุนุงุฑุงุช ุฎุงุฑุฌ ุงูุชุทุจูู** - ุชุนูู ุญุชู ุนูุฏูุง ูููู ุงูุชุทุจูู ูุบูู

## ๐ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ

### โ ุงูุฅุดุนุงุฑุงุช ุงููุฎุตุตุฉ
- ุฅุดุนุงุฑุงุช ุชุธูุฑ ููุท ูููุณุชุฎุฏู ุงููุญุฏุฏ
- ุฏุนู ุงูุฅุดุนุงุฑุงุช ูู ุงูุฎูููุฉ ูุงูููุฏูุฉ
- ุตูุช ูุงูุชุฒุงุฒ ูุฎุตุต ููู ุฅุดุนุงุฑ
- ุญูุธ ุชููุงุฆู ููุฅุดุนุงุฑุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### โ ุงููุตุงุฏูุฉ ุงููุณุชูุฑุฉ
- ุงูุญูุงุธ ุนูู ุชุณุฌูู ุงูุฏุฎูู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู
- ุฎูุงุฑ "ุชุฐูุฑูู" ูููุณุชุฎุฏููู
- ุชุณุฌูู ุฎุฑูุฌ ุนุงุฏู ุฃู ูุงูู
- ูุญุต ุตุญุฉ ุงูุฌูุณุฉ ุชููุงุฆูุงู

### โ ุงูุฃูุงู ุงููุญุณู
- ุชุดููุฑ ุงูุจูุงูุงุช ุงููุญููุธุฉ
- ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฌูุณุงุช ุงููุฏููุฉ
- ูุญุต ุตุญุฉ ุงููุณุชุฎุฏู ูุจู ุนุฑุถ ุงูุฅุดุนุงุฑุงุช

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ

```
lib/services/
โโโ enhanced_push_notification_service.dart    # ุฎุฏูุฉ ุงูุฅุดุนุงุฑุงุช ุงููุญุณูุฉ
โโโ persistent_auth_service.dart               # ุฎุฏูุฉ ุงููุตุงุฏูุฉ ุงููุณุชูุฑุฉ
โโโ enhanced_background_handler.dart           # ูุนุงูุฌ ุงูุฑุณุงุฆู ูู ุงูุฎูููุฉ

lib/screens/
โโโ auth/enhanced_login_screen.dart            # ุดุงุดุฉ ุชุณุฌูู ุฏุฎูู ูุญุณูุฉ
โโโ settings/notification_auth_settings_screen.dart  # ุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช
```

## ๐๏ธ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุชููุฆุฉ ุงููุธุงู

```dart
// ูู main.dart
await EnhancedPushNotificationService().initialize();
await PersistentAuthService().initialize();
```

### 2. ุชุณุฌูู ุงูุฏุฎูู ูุน "ุชุฐูุฑูู"

```dart
final authService = PersistentAuthService();

final user = await authService.signInWithEmailAndPassword(
  email: email,
  password: password,
  rememberMe: true, // ุงูุญูุงุธ ุนูู ุชุณุฌูู ุงูุฏุฎูู
);
```

### 3. ุฅุฑุณุงู ุฅุดุนุงุฑ ููุณุชุฎุฏู ูุญุฏุฏ

```dart
final notificationService = EnhancedPushNotificationService();

await notificationService.sendNotificationToUser(
  userId: 'user_id_here',
  title: 'ุนููุงู ุงูุฅุดุนุงุฑ',
  body: 'ูุญุชูู ุงูุฅุดุนุงุฑ',
  data: {
    'type': 'student_boarded',
    'studentId': 'student_123',
  },
);
```

### 4. ุชุณุฌูู ุงูุฎุฑูุฌ

```dart
// ุชุณุฌูู ุฎุฑูุฌ ุนุงุฏู (ูุญูุธ ุจุนุถ ุงูุจูุงูุงุช)
await authService.signOut();

// ุชุณุฌูู ุฎุฑูุฌ ูุงูู (ููุณุญ ุฌููุน ุงูุจูุงูุงุช)
await authService.signOut(clearPersistedData: true);
```

## ๐ง ุงูุฅุนุฏุงุฏุงุช ุงููุชุงุญุฉ

### ุฅุนุฏุงุฏุงุช ุงููุตุงุฏูุฉ
- **ุชุณุฌูู ุงูุฏุฎูู ุงูุชููุงุฆู**: ุชูุนูู/ุฅูุบุงุก ุงูุญูุงุธ ุนูู ุชุณุฌูู ุงูุฏุฎูู
- **ูุฏุฉ ุงูุฌูุณุฉ**: 30 ููู ุงูุชุฑุงุถูุงู
- **ูุญุต ุตุญุฉ ุงูุฌูุณุฉ**: ุชููุงุฆู ุนูุฏ ุจุฏุก ุงูุชุทุจูู

### ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช
- **ุชูุนูู ุงูุฅุดุนุงุฑุงุช**: ุชุดุบูู/ุฅููุงู ุงูุฅุดุนุงุฑุงุช
- **ุงูุตูุช**: ุชุดุบูู/ุฅููุงู ุตูุช ุงูุฅุดุนุงุฑุงุช
- **ุงูุงูุชุฒุงุฒ**: ุชุดุบูู/ุฅููุงู ุงูุชุฒุงุฒ ุงูุฅุดุนุงุฑุงุช

## ๐ฑ ููููุฉ ุนูู ุงููุธุงู

### 1. ุงูุฅุดุนุงุฑุงุช ุงููุฎุตุตุฉ

```mermaid
graph TD
    A[ุฅุฑุณุงู ุฅุดุนุงุฑ] --> B[ุชุญุฏูุฏ ุงููุณุชุฎุฏู ุงููุณุชูุฏู]
    B --> C[ูุญุต ุงููุณุชุฎุฏู ุงูุญุงูู]
    C --> D{ูู ุงูุฅุดุนุงุฑ ูููุณุชุฎุฏู ุงูุญุงููุ}
    D -->|ูุนู| E[ุนุฑุถ ุงูุฅุดุนุงุฑ]
    D -->|ูุง| F[ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุท]
    E --> G[ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช]
    F --> G
```

### 2. ุงููุตุงุฏูุฉ ุงููุณุชูุฑุฉ

```mermaid
graph TD
    A[ุจุฏุก ุงูุชุทุจูู] --> B[ูุญุต ุงูุจูุงูุงุช ุงููุญููุธุฉ]
    B --> C{ูู ููุฌุฏ ุชุณุฌูู ุฏุฎูู ูุญููุธุ}
    C -->|ูุนู| D[ูุญุต ุตุญุฉ ุงูุฌูุณุฉ]
    C -->|ูุง| E[ุนุฑุถ ุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู]
    D --> F{ูู ุงูุฌูุณุฉ ุตุญูุญุฉุ}
    F -->|ูุนู| G[ุชุณุฌูู ุฏุฎูู ุชููุงุฆู]
    F -->|ูุง| H[ูุณุญ ุงูุจูุงูุงุช ุงููุญููุธุฉ]
    H --> E
```

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุงูุฅุดุนุงุฑุงุช

**ุงููุดููุฉ**: ุงูุฅุดุนุงุฑุงุช ูุง ุชุธูุฑ
```dart
// ุงูุญู: ูุญุต ุงูุฃุฐููุงุช
final settings = await FirebaseMessaging.instance.requestPermission();
print('Permission status: ${settings.authorizationStatus}');
```

**ุงููุดููุฉ**: ุงูุฅุดุนุงุฑุงุช ุชุธูุฑ ูููุณุชุฎุฏู ุงูุฎุทุฃ
```dart
// ุงูุญู: ุงูุชุฃูุฏ ูู ุชุญุฏูุฏ userId ูู ุงูุจูุงูุงุช
await notificationService.sendNotificationToUser(
  userId: correctUserId, // ุชุฃูุฏ ูู ุตุญุฉ ุงููุนุฑู
  title: title,
  body: body,
  data: {
    'userId': correctUserId, // ุฅุถุงูุฉ ุงููุนุฑู ูู ุงูุจูุงูุงุช ุฃูุถุงู
    'recipientId': correctUserId,
  },
);
```

### ูุดุงูู ุงููุตุงุฏูุฉ

**ุงููุดููุฉ**: ุงููุณุชุฎุฏู ูุฎุฑุฌ ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู
```dart
// ุงูุญู: ุงูุชุฃูุฏ ูู ุชูุนูู "ุชุฐูุฑูู"
await authService.signInWithEmailAndPassword(
  email: email,
  password: password,
  rememberMe: true, // ุชุฃูุฏ ูู ุชูุนูู ูุฐุง ุงูุฎูุงุฑ
);
```

**ุงููุดููุฉ**: ุงูุฌูุณุฉ ุชูุชูู ุจุณุฑุนุฉ
```dart
// ุงูุญู: ูุญุต ุฅุนุฏุงุฏุงุช ุงูุชูุงุก ุงูุตูุงุญูุฉ
final sessionInfo = await authService.getSessionInfo();
print('Login timestamp: ${sessionInfo['loginTimestamp']}');
```

## ๐ ูุฑุงูุจุฉ ุงูุฃุฏุงุก

### ุฅุญุตุงุฆูุงุช ุงูุฅุดุนุงุฑุงุช
```dart
// ูุญุต ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุงููุฑุณูุฉ
final notificationLogs = await FirebaseFirestore.instance
    .collection('notification_logs')
    .where('type', isEqualTo: 'background')
    .get();

print('Total notifications: ${notificationLogs.docs.length}');
```

### ุฅุญุตุงุฆูุงุช ุงููุตุงุฏูุฉ
```dart
// ูุญุต ูุนูููุงุช ุงูุฌูุณุฉ
final sessionInfo = await authService.getSessionInfo();
print('Session info: $sessionInfo');
```

## ๐จ ุงูุชุฎุตูุต

### ุชุฎุตูุต ุงูุฅุดุนุงุฑุงุช
```dart
// ุชุฎุตูุต ุดูู ุงูุฅุดุนุงุฑ
const androidDetails = AndroidNotificationDetails(
  'mybus_notifications',
  'ููุฏุฒ ุจุงุต',
  channelDescription: 'ุฅุดุนุงุฑุงุช ุชุทุจูู ููุฏุฒ ุจุงุต',
  importance: Importance.high,
  priority: Priority.high,
  sound: RawResourceAndroidNotificationSound('custom_sound'), // ุตูุช ูุฎุตุต
  icon: '@mipmap/custom_icon', // ุฃููููุฉ ูุฎุตุตุฉ
  color: Colors.blue, // ููู ูุฎุตุต
);
```

### ุชุฎุตูุต ุงููุตุงุฏูุฉ
```dart
// ุชุฎุตูุต ูุฏุฉ ุงูุฌูุณุฉ
const sessionDuration = Duration(days: 60); // 60 ููู ุจุฏูุงู ูู 30

// ุชุฎุตูุต ุฅุนุฏุงุฏุงุช ุงูุญูุธ
await authService.setAutoLoginEnabled(false); // ุฅูุบุงุก ุงูุชุณุฌูู ุงูุชููุงุฆู
```

## ๐ ุงูุฃูุงู

### ุญูุงูุฉ ุงูุจูุงูุงุช
- ุชุดููุฑ ุงูุจูุงูุงุช ุงููุญููุธุฉ ูุญููุงู
- ูุญุต ุตุญุฉ ุงูุฌูุณุฉ ุฏูุฑูุงู
- ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฌูุณุงุช ุงููุฏููุฉ
- ูุณุญ ุงูุจูุงูุงุช ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ ุงููุงูู

### ุฃูุถู ุงูููุงุฑุณุงุช
1. **ุงุณุชุฎุฏู ุชุณุฌูู ุงูุฎุฑูุฌ ุงููุงูู** ุนูุฏ ุงูุญุงุฌุฉ ูุฃูุงู ุฅุถุงูู
2. **ูุญุต ุตุญุฉ ุงูุฌูุณุฉ** ุฏูุฑูุงู ูู ุงูุชุทุจููุงุช ุงูุญุณุงุณุฉ
3. **ุชุญุฏูุฏ ุงููุณุชุฎุฏู ุงููุณุชูุฏู** ูู ุฌููุน ุงูุฅุดุนุงุฑุงุช
4. **ูุฑุงูุจุฉ logs ุงูุฅุดุนุงุฑุงุช** ูุถูุงู ุงููุตูู ุงูุตุญูุญ

## ๐ ุงูุฏุนู

### ุงูุญุตูู ุนูู ุงููุณุงุนุฏุฉ
- ุฑุงุฌุน logs ุงูุชุทุจูู ููุฃุฎุทุงุก
- ุงุณุชุฎุฏู ุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช ููุญุต ุงูุญุงูุฉ
- ุชุญูู ูู ุฃุฐููุงุช ุงูุฅุดุนุงุฑุงุช ูู ุงููุธุงู

### ุงูุฅุจูุงุบ ุนู ุงููุดุงูู
- ุงุญูุธ logs ุงูุฃุฎุทุงุก
- ูุตู ุงูุฎุทูุงุช ุงููุคุฏูุฉ ูููุดููุฉ
- ุงุฐูุฑ ููุน ุงูุฌูุงุฒ ููุณุฎุฉ ุงููุธุงู

---

## ๐ ุงูุฎูุงุตุฉ

ุงููุธุงู ุงููุญุณู ููุฅุดุนุงุฑุงุช ูุงููุตุงุฏูุฉ ูููุฑ:
- **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ** ูุน ุงูุญูุงุธ ุนูู ุชุณุฌูู ุงูุฏุฎูู
- **ุฅุดุนุงุฑุงุช ุฏูููุฉ ููุฎุตุตุฉ** ููู ูุณุชุฎุฏู
- **ุฃูุงู ุนุงูู** ูุน ุฅููุงููุฉ ุงูุชุญูู ุงููุงูู
- **ุณูููุฉ ุงูุงุณุชุฎุฏุงู** ูุน ุฅุนุฏุงุฏุงุช ูุฑูุฉ

ุชู ุชุตููู ุงููุธุงู ููููู **ููุซูู** ู **ุขูู** ู **ุณูู ุงูุตูุงูุฉ** ูุถูุงู ุฃูุถู ุชุฌุฑุจุฉ ูู ุชุทุจูู ููุฏุฒ ุจุงุต ๐